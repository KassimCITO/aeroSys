{% extends "base.html" %}
{% block title %}Vuelos{% endblock %}

{% block head %}
<script defer>
// Variables globales y funciones
var aeronaves = [];
var pilotos = [];
var canConfirmVuelos = false; // Variable para controlar permisos de confirmación

function showCreate() {
    resetForm();
    document.getElementById('formTitle').textContent = 'Nuevo Vuelo';
    document.getElementById('formCard').style.display = 'block';
    loadAeronaves();
    loadPilotos();
}

function showMessage(message, type) {
    type = type || 'success';
    var alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-' + type + ' alert-dismissible fade show';
    alertDiv.innerHTML = message + '<button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
    
    // Buscar un contenedor válido para insertar el mensaje
    var container = document.querySelector('.container');
    var h3 = document.querySelector('h3');
    
    if (container && h3) {
        // Insertar después del h3
        container.insertBefore(alertDiv, h3.nextSibling);
    } else if (container) {
        // Si no hay h3, insertar al principio del contenedor
        container.insertBefore(alertDiv, container.firstChild);
    } else {
        // Fallback: insertar al principio del body
        document.body.insertBefore(alertDiv, document.body.firstChild);
    }
    
    setTimeout(function() { 
        if (alertDiv.parentNode) {
            alertDiv.remove(); 
        }
    }, 5000);
}

function validateForm() {
    var form = document.getElementById('vueloForm');
    if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return false;
    }
    return true;
}

function resetForm() {
    var form = document.getElementById('vueloForm');
    form.reset();
    form.classList.remove('was-validated');
    // Establecer valores por defecto
    document.getElementById('estado').value = 'Programado';
    // Limpiar campos ocultos
    document.getElementById('vuelo_id').value = '';
}

function hideForm() {
    resetForm();
    document.getElementById('formCard').style.display = 'none';
}

function loadAeronaves() {
    fetch('/api/aeronaves')
        .then(function(response) {
            if (!response.ok) throw new Error('Error al cargar aeronaves');
            return response.json();
        })
        .then(function(data) {
            aeronaves = data;
            var select = document.getElementById('aeronave_id');
            select.innerHTML = '<option value="">Seleccione una aeronave</option>';
            data.forEach(function(a) {
                var option = document.createElement('option');
                option.value = a.aeronave_id;
                option.textContent = a.matricula + ' - ' + a.modelo;
                select.appendChild(option);
            });
        })
        .catch(function(error) {
            showMessage('Error al cargar aeronaves: ' + error.message, 'danger');
        });
}

function loadPilotos() {
    fetch('/api/pilotos')
        .then(function(response) {
            if (!response.ok) throw new Error('Error al cargar pilotos');
            return response.json();
        })
        .then(function(data) {
            pilotos = data;
            // Cargar selector de piloto
            var selectPiloto = document.getElementById('piloto_id');
            selectPiloto.innerHTML = '<option value="">Seleccione un piloto</option>';
            
            // Cargar selector de copiloto
            var selectCopiloto = document.getElementById('copiloto_id');
            selectCopiloto.innerHTML = '<option value="">Seleccione un copiloto (opcional)</option>';
            
            // Agregar opciones a ambos selectores
            data.forEach(function(p) {
                // Opción para piloto
                var optionPiloto = document.createElement('option');
                optionPiloto.value = p.piloto_id;
                optionPiloto.textContent = p.nombre + ' (' + p.licencia + ')';
                selectPiloto.appendChild(optionPiloto);
                
                // Opción para copiloto
                var optionCopiloto = document.createElement('option');
                optionCopiloto.value = p.piloto_id;
                optionCopiloto.textContent = p.nombre + ' (' + p.licencia + ')';
                selectCopiloto.appendChild(optionCopiloto);
            });
        })
        .catch(function(error) {
            showMessage('Error al cargar pilotos: ' + error.message, 'danger');
        });
}

function fetchVuelos() {
    // Obtener valores de los filtros
    var estado = document.getElementById('filtro_estado').value;
    var fecha_desde = document.getElementById('filtro_fecha_desde').value;
    var fecha_hasta = document.getElementById('filtro_fecha_hasta').value;
    
    // Construir URL con filtros
    var url = '/api/vuelos?';
    var params = [];
    if (estado) params.push('estado=' + encodeURIComponent(estado));
    if (fecha_desde) params.push('fecha_desde=' + encodeURIComponent(fecha_desde));
    if (fecha_hasta) params.push('fecha_hasta=' + encodeURIComponent(fecha_hasta));
    
    if (params.length > 0) {
        url += params.join('&');
    }

    fetch(url)
        .then(function(response) {
            if (!response.ok) throw new Error('Error al cargar vuelos');
            return response.json();
        })
        .then(function(data) {
            var tbody = document.getElementById('vuelosTable');
            if (tbody) {
                tbody.innerHTML = '';
                
                data.forEach(function(r) {
                    var aeronave = aeronaves.find(function(a) { return a.aeronave_id === r.id_aeronave; });
                    var piloto = pilotos.find(function(p) { return p.piloto_id === r.id_piloto; });
                    
                    var tr = document.createElement('tr');
                    tr.innerHTML = '<td>' + r.codigo_vuelo + '</td>' +
                                  '<td>' + r.origen + '</td>' +
                                  '<td>' + r.destino + '</td>' +
                                  '<td>' + new Date(r.fecha_salida).toLocaleString() + '</td>' +
                                  '<td>' + (r.fecha_llegada ? new Date(r.fecha_llegada).toLocaleString() : '-') + '</td>' +
                                  '<td>' + (aeronave ? aeronave.matricula : r.id_aeronave) + '</td>' +
                                  '<td>' + (piloto ? piloto.nombre : r.id_piloto) + '</td>' +
                                  '<td>' + (r.id_copiloto ? pilotos.find(p => p.piloto_id === r.id_copiloto).nombre : '-') + '</td>' +
                                  '<td>' + (r.observaciones || '-') + '</td>' +
                                  '<td>' +
                                  '<button class="btn btn-sm btn-warning" title="Editar" onclick="editV(' + r.id_vuelo + ')"><i class="fas fa-edit"></i></button> ' +
                                  '<button class="btn btn-sm btn-danger" title="Eliminar" onclick="delV(' + r.id_vuelo + ')"><i class="fas fa-trash"></i></button> ' +
                                  (canConfirmVuelos ? '<button class="btn btn-sm btn-success" onclick="confirmarVuelo(' + r.id_vuelo + ')" title="Confirmar Vuelo">' +
                                  '<i class="fas fa-check-circle"></i>' +
                                  '</button>' : '') +
                                  '</td>';
                    tbody.appendChild(tr);
                });
            }
        })
        .catch(function(error) {
            showMessage(error.message, 'danger');
        });
}

function saveVuelo() {
    if (!validateForm()) {
        showMessage('Por favor complete todos los campos requeridos', 'warning');
        return false;
    }

    var vuelo_id = document.getElementById('vuelo_id').value;
    var method = vuelo_id ? 'PUT' : 'POST';
    var url = '/api/vuelos' + (vuelo_id ? '/' + vuelo_id : '');

    var payload = {
        numero_vuelo: document.getElementById('numero_vuelo').value,
        origen: document.getElementById('origen').value,
        destino: document.getElementById('destino').value,
        fecha_salida: document.getElementById('fecha_salida').value,
        fecha_llegada: document.getElementById('fecha_llegada').value,
        aeronave_id: parseInt(document.getElementById('aeronave_id').value),
        piloto_id: parseInt(document.getElementById('piloto_id').value),
        copiloto_id: document.getElementById('copiloto_id').value ? parseInt(document.getElementById('copiloto_id').value) : null,
        estado: document.getElementById('estado').value,
        observaciones: document.getElementById('observaciones').value || null
    };

    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify(payload)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => { throw new Error(text) });
        }
        return response.json();
    })
    .then(data => {
        // Hide form and refresh table immediately
        hideForm();
        fetchVuelos();
        showMessage(vuelo_id ? 'Vuelo actualizado exitosamente' : 'Vuelo creado exitosamente', 'success');
    })
    .catch(error => {
        showMessage('Error: ' + error.message, 'danger');
        console.error('Error:', error);
    });

    return false;
}

function editV(id) {
    fetch('/api/vuelos/' + id)
        .then(function(response) {
            if (!response.ok) throw new Error('Error al cargar el vuelo');
            return response.json();
        })
        .then(function(data) {
            document.getElementById('numero_vuelo').value = data.codigo_vuelo;
            document.getElementById('origen').value = data.origen;
            document.getElementById('destino').value = data.destino;
            document.getElementById('fecha_salida').value = data.fecha_salida ? data.fecha_salida.substring(0, 16) : '';
            document.getElementById('fecha_llegada').value = data.fecha_llegada ? data.fecha_llegada.substring(0, 16) : '';
            document.getElementById('aeronave_id').value = data.id_aeronave;
            document.getElementById('piloto_id').value = data.id_piloto;
            document.getElementById('copiloto_id').value = data.id_copiloto || '';
            document.getElementById('estado').value = data.estado || 'Programado';
            document.getElementById('observaciones').value = data.observaciones || '';
            
            document.getElementById('formTitle').textContent = 'Editar Vuelo (ID ' + id + ')';
            document.getElementById('formCard').style.display = 'block';
            
            document.querySelector('#formCard button.btn-primary').onclick = function() {
                if (!validateForm()) return;
                
                var payload = {
                    codigo_vuelo: document.getElementById('numero_vuelo').value,
                    origen: document.getElementById('origen').value,
                    destino: document.getElementById('destino').value,
                    fecha_salida: document.getElementById('fecha_salida').value,
                    fecha_llegada: document.getElementById('fecha_llegada').value || null,
                    id_aeronave: parseInt(document.getElementById('aeronave_id').value),
                    id_piloto: parseInt(document.getElementById('piloto_id').value),
                    id_copiloto: document.getElementById('copiloto_id').value ? parseInt(document.getElementById('copiloto_id').value) : null,
                    estado: document.getElementById('estado').value,
                    observaciones: document.getElementById('observaciones').value || null
                };
                
                fetch('/api/vuelos/' + id, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                })
                .then(function(response) {
                    if (!response.ok) throw new Error('Error al actualizar el vuelo');
                    // Hide form and refresh table immediately
                    hideForm();
                    fetchVuelos();
                    showMessage('Vuelo actualizado exitosamente', 'success');
                })
                .catch(function(error) {
                    showMessage(error.message, 'danger');
                });
            };
        })
        .catch(function(error) {
            showMessage(error.message, 'danger');
        });
}

function delV(id) {
    if (!confirm('¿Está seguro que desea eliminar el vuelo #' + id + '?')) return;
    
    fetch('/api/vuelos/' + id, {method: 'DELETE'})
        .then(function(response) {
            if (!response.ok) throw new Error('Error al eliminar el vuelo');
            showMessage('Vuelo eliminado exitosamente');
            fetchVuelos();
        })
        .catch(function(error) {
            showMessage(error.message, 'danger');
        });
}

function init() {
    // Cargar datos iniciales
    loadAeronaves();
    loadPilotos();
    fetchVuelos();
    checkUserPermissions();

    // Agregar evento submit al formulario
    document.getElementById('vueloForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveVuelo();
    });
}

function checkUserPermissions() {
    // Verificar si el usuario puede confirmar vuelos
    // Los pilotos e invitados no pueden confirmar vuelos
    fetch('/api/usuario-actual')
        .then(function(response) {
            if (!response.ok) throw new Error('Error al verificar permisos');
            return response.json();
        })
        .then(function(user) {
            // Solo operadores autorizados (admin, operador) pueden confirmar vuelos
            canConfirmVuelos = !['piloto', 'invitado'].includes(user.rol);
        })
        .catch(function(error) {
            console.error('Error al verificar permisos:', error);
            canConfirmVuelos = false;
        });
}

// Funciones para filtros y exportación
function aplicarFiltros() {
    var estado = document.getElementById('filtro_estado').value;
    var fecha_desde = document.getElementById('filtro_fecha_desde').value;
    var fecha_hasta = document.getElementById('filtro_fecha_hasta').value;
    
    // Construir URL con filtros
    var url = '/reports/vuelos?';
    var params = [];
    if (estado) params.push('estado=' + encodeURIComponent(estado));
    if (fecha_desde) params.push('fecha_desde=' + encodeURIComponent(fecha_desde));
    if (fecha_hasta) params.push('fecha_hasta=' + encodeURIComponent(fecha_hasta));
    
    if (params.length > 0) {
        url += params.join('&');
    }
    
    // Abrir reporte en nueva ventana
    window.open(url, '_blank');
}

function exportarPDF() {
    var estado = document.getElementById('filtro_estado').value;
    var fecha_desde = document.getElementById('filtro_fecha_desde').value;
    var fecha_hasta = document.getElementById('filtro_fecha_hasta').value;
    
    // Construir URL con filtros
    var url = '/reports/vuelos?';
    var params = [];
    if (estado) params.push('estado=' + encodeURIComponent(estado));
    if (fecha_desde) params.push('fecha_desde=' + encodeURIComponent(fecha_desde));
    if (fecha_hasta) params.push('fecha_hasta=' + encodeURIComponent(fecha_hasta));
    
    if (params.length > 0) {
        url += params.join('&');
    }
    
    // Descargar PDF
    window.location.href = url;
}

function exportarExcel() {
    var estado = document.getElementById('filtro_estado').value;
    var fecha_desde = document.getElementById('filtro_fecha_desde').value;
    var fecha_hasta = document.getElementById('filtro_fecha_hasta').value;
    
    // Construir URL con filtros
    var url = '/reports/vuelos?formato=excel';
    var params = [];
    if (estado) params.push('estado=' + encodeURIComponent(estado));
    if (fecha_desde) params.push('fecha_desde=' + encodeURIComponent(fecha_desde));
    if (fecha_hasta) params.push('fecha_hasta=' + encodeURIComponent(fecha_hasta));
    
    if (params.length > 0) {
        url += '&' + params.join('&');
    }
    
    // Descargar Excel
    window.location.href = url;
}

// Función para confirmar vuelo
function confirmarVuelo(vueloId) {
    // Verificar si el usuario tiene permisos (no piloto ni invitado)
    // Esta verificación se puede hacer en el backend también
    fetch('/api/vuelos/' + vueloId)
        .then(function(response) {
            if (!response.ok) throw new Error('Error al cargar el vuelo');
            return response.json();
        })
        .then(function(vuelo) {
            // Cargar información del vuelo en el modal
            var aeronave = aeronaves.find(function(a) { return a.aeronave_id === vuelo.id_aeronave; });
            var piloto = pilotos.find(function(p) { return p.piloto_id === vuelo.id_piloto; });
            
            document.getElementById('vuelo_id_confirmar').value = vueloId;
            document.getElementById('vueloInfo').innerHTML = 
                '<div class="row">' +
                '<div class="col-md-6"><strong>Número de Vuelo:</strong><br>' + vuelo.codigo_vuelo + '</div>' +
                '<div class="col-md-6"><strong>Ruta:</strong><br>' + vuelo.origen + ' → ' + vuelo.destino + '</div>' +
                '</div>' +
                '<div class="row mt-2">' +
                '<div class="col-md-6"><strong>Fecha Salida:</strong><br>' + new Date(vuelo.fecha_salida).toLocaleString() + '</div>' +
                '<div class="col-md-6"><strong>Fecha Llegada:</strong><br>' + (vuelo.fecha_llegada ? new Date(vuelo.fecha_llegada).toLocaleString() : 'No programada') + '</div>' +
                '</div>' +
                '<div class="row mt-2">' +
                '<div class="col-md-6"><strong>Aeronave:</strong><br>' + (aeronave ? aeronave.matricula + ' - ' + aeronave.modelo : 'N/A') + '</div>' +
                '<div class="col-md-6"><strong>Piloto:</strong><br>' + (piloto ? piloto.nombre + ' (' + piloto.licencia + ')' : 'N/A') + '</div>' +
                '</div>';
            
            // Limpiar formulario
            document.getElementById('estado_confirmacion').value = '';
            document.getElementById('notas_confirmacion').value = '';
            
            // Mostrar modal
            var modal = new bootstrap.Modal(document.getElementById('confirmarVueloModal'));
            modal.show();
        })
        .catch(function(error) {
            showMessage('Error al cargar información del vuelo: ' + error.message, 'danger');
        });
}

// Función para guardar confirmación
function guardarConfirmacion() {
    var vueloId = document.getElementById('vuelo_id_confirmar').value;
    var estado = document.getElementById('estado_confirmacion').value;
    var notas = document.getElementById('notas_confirmacion').value;
    
    if (!estado) {
        showMessage('Por favor seleccione un estado de confirmación', 'warning');
        return;
    }
    
    var payload = {
        vuelo_id: parseInt(vueloId),
        estado: estado,
        notas: notas
    };
    
    fetch('/api/confirmaciones', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify(payload)
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => { throw new Error(text) });
        }
        return response.json();
    })
    .then(data => {
        showMessage('Confirmación guardada exitosamente', 'success');
        // Cerrar modal
        var modalElement = document.getElementById('confirmarVueloModal');
        var modal = bootstrap.Modal.getInstance(modalElement);
        if (modal) {
            modal.hide();
        } else {
            // If no instance exists, create one and hide it
            var newModal = new bootstrap.Modal(modalElement);
            newModal.hide();
        }
        // Recargar tabla de vuelos
        fetchVuelos();
    })
    .catch(error => {
        showMessage('Error al guardar confirmación: ' + error.message, 'danger');
        console.error('Error:', error);
    });
}

// Inicializar cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    init();
});
</script>
{% endblock %}

{% block content %}
<div class="container">
    <h3 class="my-4">Gestión de Vuelos</h3>
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <div>
            <button class="btn btn-primary" onclick="showCreate()">
                <i class="fas fa-plus"></i> Nuevo vuelo
            </button>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-success" onclick="exportarPDF()">
                <i class="fas fa-file-pdf"></i> Exportar a PDF
            </button>
            <button class="btn btn-success" onclick="exportarExcel()">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Filtros</h5>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="filtro_estado" class="form-label">Estátus</label>
                    <select class="form-select" id="filtro_estado">
                        <option value="">Todos</option>
                        <option value="Programado">Programado</option>
                        <option value="En Vuelo">En Vuelo</option>
                        <option value="Completado">Completado</option>
                        <option value="Cancelado">Cancelado</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="filtro_fecha_desde" class="form-label">Fecha Desde</label>
                    <input type="date" class="form-control" id="filtro_fecha_desde">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="filtro_fecha_hasta" class="form-label">Fecha Hasta</label>
                    <input type="date" class="form-control" id="filtro_fecha_hasta">
                </div>
                <div class="col-md-3 d-flex align-items-end mb-3">
                    <button class="btn btn-outline-primary" onclick="aplicarFiltros()">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulario de Vuelo -->
    <div class="card mb-4" id="formCard" style="display: none;">
        <div class="card-body">
            <h4 class="card-title" id="formTitle">Nuevo Vuelo</h4>
            <form id="vueloForm">
                <input type="hidden" id="vuelo_id">
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="numero_vuelo" class="form-label">Número de Vuelo *</label>
                        <input type="text" class="form-control" id="numero_vuelo" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="aeronave_id" class="form-label">Aeronave *</label>
                        <select class="form-select" id="aeronave_id" required>
                            <option value="">Seleccione una aeronave</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="origen" class="form-label">Origen *</label>
                        <input type="text" class="form-control" id="origen" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="destino" class="form-label">Destino *</label>
                        <input type="text" class="form-control" id="destino" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="fecha_salida" class="form-label">Fecha y Hora de Salida *</label>
                        <input type="datetime-local" class="form-control" id="fecha_salida" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="fecha_llegada" class="form-label">Fecha y Hora de Llegada *</label>
                        <input type="datetime-local" class="form-control" id="fecha_llegada" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="piloto_id" class="form-label">Piloto *</label>
                        <select class="form-select" id="piloto_id" required>
                            <option value="">Seleccione un piloto</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="copiloto_id" class="form-label">Copiloto</label>
                        <select class="form-select" id="copiloto_id">
                            <option value="">Seleccione un copiloto (opcional)</option>
                        </select>
                    </div>
                </div>

                <!-- Agregar este bloque dentro del formulario, después del div de piloto/copiloto -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="estado" class="form-label">Estatus actual *</label>
                        <select class="form-select" id="estado" required>
                            <option value="Programado">Programado</option>
                            <option value="En Vuelo">En Vuelo</option>
                            <option value="Completado">Completado</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="observaciones" class="form-label">Observaciones</label>
                        <input type="text" class="form-control" id="observaciones" maxlength="500">
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideForm()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabla de Vuelos -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Origen</th>
                            <th>Destino</th>
                            <th>Salida</th>
                            <th>Llegada</th>
                            <th>Aeronave</th>
                            <th>Piloto</th>
                            <th>Copiloto</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="vuelosTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
<!-- Modal de éxito -->
<div class="modal fade" id="saveSuccessModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-check-circle text-success me-2"></i>Operación exitosa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="saveSuccessMessage">Cambios guardados correctamente.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
      </div>
    </div>
  </div>
</div>

</div>

<!-- Modal para Confirmar Vuelo -->
<div class="modal fade" id="confirmarVueloModal" tabindex="-1" aria-labelledby="confirmarVueloModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmarVueloModalLabel">
                    <i class="fas fa-check-circle text-success me-2"></i>Confirmar Vuelo
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Información del Vuelo:</strong>
                </div>
                <div id="vueloInfo" class="mb-3">
                    <!-- La información del vuelo se cargará aquí dinámicamente -->
                </div>
                
                <form id="confirmarVueloForm">
                    <input type="hidden" id="vuelo_id_confirmar">
                    
                    <div class="mb-3">
                        <label for="estado_confirmacion" class="form-label">Estado de Confirmación *</label>
                        <select class="form-select" id="estado_confirmacion" required>
                            <option value="">Seleccione un estado</option>
                            <option value="Confirmado">Confirmado</option>
                            <option value="Pendiente">Pendiente</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notas_confirmacion" class="form-label">Notas Adicionales</label>
                        <textarea class="form-control" id="notas_confirmacion" rows="3" 
                                placeholder="Ingrese cualquier observación o nota adicional..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-success" onclick="guardarConfirmacion()">
                    <i class="fas fa-save me-1"></i>Guardar Confirmación
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}